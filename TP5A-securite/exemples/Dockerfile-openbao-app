FROM python:3.14-slim

# Installer les dépendances système
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Créer utilisateur non-root
RUN useradd -m -u 1001 -s /bin/bash appuser

WORKDIR /app

# Installer les dépendances Python
RUN pip install --no-cache-dir hvac requests

# Copier l'application
COPY app-openbao.py .

# Rendre le script exécutable
RUN chmod +x app-openbao.py

# Changer le propriétaire
RUN chown -R appuser:appuser /app

# Passer à l'utilisateur non-root
USER appuser

# L'application récupère les secrets depuis OpenBao
CMD ["python3", "app-openbao.py"]
