FROM python:3.14-slim

# Créer utilisateur non-root
RUN useradd -m -u 1001 -s /bin/bash appuser

WORKDIR /app

# Copier l'application
COPY app-with-secrets.py .

# Rendre le script exécutable
RUN chmod +x app-with-secrets.py

# Changer le propriétaire
RUN chown -R appuser:appuser /app

# Passer à l'utilisateur non-root
USER appuser

# L'application lit les secrets depuis /run/secrets/
# Montés automatiquement par Podman avec --secret
CMD ["python3", "app-with-secrets.py"]
